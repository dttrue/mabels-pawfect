generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Booking {
  id        String    @id @default(cuid())
  fullName  String
  phone     String
  address   String
  pets      Json
  service   String
  status    String    @default("pending")
  notes     String?
  createdAt DateTime  @default(now())
  token     String?   @unique
  expiresAt DateTime?
  email     String
  entries   Json?
}

model Review {
  id        String   @id @default(uuid())
  name      String
  message   String
  imageUrl  String?
  approved  Boolean  @default(false)
  createdAt DateTime @default(now())
  rating    Int?
}

model Newsletter {
  id          String   @id @default(uuid())
  title       String
  description String?
  imageUrl    String
  fileUrl     String?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  altText     String?
  keywords    String[] @default([])
  publicId    String?
}

model BlockedDate {
  id        String   @id @default(uuid())
  date      DateTime
  createdAt DateTime @default(now())
  service   String   @default("overnight")

  @@unique([date, service])
}

model Gallery {
  id               String             @id @default(uuid())
  imageUrl         String
  altText          String?
  caption          String?
  publicId         String             @unique
  deletedAt        DateTime?
  createdAt        DateTime           @default(now())
  category         GalleryCategory    @default(HAPPY)
  keywords         String[]           @default([])
  GalleryToProduct GalleryToProduct[]

  @@map("ProviderGallery")
}

model SiteImage {
  id        String   @id @default(cuid())
  key       String   @unique  // e.g. "about-me", "hero-christmas-2025"
  imageUrl  String
  publicId  String
  alt       String
  caption   String?
  keywords  String[] @default([])
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


model Category {
  id       String    @id @default(cuid())
  slug     String    @unique
  name     String
  products Product[] @relation("CategoryToProduct")
}

model Product {
  id               String             @id @default(cuid())
  slug             String             @unique
  title            String
  subtitle         String?
  description      String?
  priceCents       Int
  active           Boolean            @default(true)
  createdAt        DateTime           @default(now())
  updatedAt        DateTime           @updatedAt
  deletedAt        DateTime?

  // ðŸ§Š Physical specs (all optional so nothing breaks)
  weightOz         Float?             // e.g. 3.9
  weightGrams      Float?             // e.g. 110.56

  lengthIn         Float?             // e.g. 5.1
  widthIn          Float?             // e.g. 5.1
  heightIn         Float?             // e.g. 4.3

  lengthCm         Float?             // e.g. 13
  widthCm          Float?             // e.g. 13
  heightCm         Float?             // e.g. 10.9

  cartItems        CartItem[]
  inventory        Inventory[]
  inventoryLogs    InventoryLog[]
  images           ProductImage[]
  variants         Variant[]
  GalleryToProduct GalleryToProduct[]
  categories       Category[]         @relation("CategoryToProduct")

  forDogs Boolean? @default(true)
  forCats Boolean? @default(false)
}


model ProductImage {
  id        String    @id @default(cuid())
  productId String
  url       String
  alt       String?
  sort      Int       @default(0)
  caption   String?
  createdAt DateTime  @default(now())
  publicId  String    @unique
  deletedAt DateTime?
  keywords  String[]  @default([])
  product   Product   @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@index([productId])
  @@index([deletedAt])
}

model Variant {
  id            String         @id @default(cuid())
  productId     String
  name          String
  priceCents    Int?
  active        Boolean        @default(true)
  cartItems     CartItem[]
  inventory     Inventory[]
  inventoryLogs InventoryLog[]
  product       Product        @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([productId, name])
  @@index([productId])
}

model Inventory {
  id        String  @id @default(cuid())
  productId String
  variantId String
  onHand    Int     @default(0)
  product   Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant   Variant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([productId, variantId])
  @@index([productId])
  @@index([variantId])
}

model CartItem {
  id         String  @id @default(cuid())
  cartId     String
  productId  String
  variantId  String
  qty        Int
  priceCents Int
  cart       Cart    @relation(fields: [cartId], references: [id], onDelete: Cascade)
  product    Product @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant    Variant @relation(fields: [variantId], references: [id], onDelete: Cascade)

  @@unique([cartId, productId, variantId])
  @@index([cartId])
  @@index([productId])
  @@index([variantId])
}

model InventoryLog {
  id        String   @id @default(cuid())
  productId String
  variantId String?
  userId    String?
  action    String
  delta     Int?
  fromQty   Int?
  toQty     Int?
  reason    String?
  source    String?
  createdAt DateTime @default(now())
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  variant   Variant? @relation(fields: [variantId], references: [id])

  @@index([productId])
  @@index([variantId])
  @@index([createdAt])
}

model Order {
  id                     String   @id @default(cuid())
  stripeSessionId        String   @unique
  stripePaymentIntentId  String   @unique

  email         String?
  phone         String?
  name          String?
  addressJson   String?
  subtotalCents Int
  totalCents    Int
  currency      String   @default("usd")
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  items OrderItem[]
}

model OrderItem {
  id          String  @id @default(cuid())

  // relation to Order
  orderId     String
  order       Order   @relation(fields: [orderId], references: [id], onDelete: Cascade)

  // optional links to your catalog
  productId   String?
  variantId   String?

  title       String
  qty         Int
  priceCents  Int

  createdAt   DateTime @default(now())

  @@index([orderId])
}



model Cart {
  id        String     @id @default(cuid())
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  items     CartItem[]
}

model Contest {
  id        String         @id @default(cuid())
  slug      String         @unique
  title     String
  startsAt  DateTime?
  endsAt    DateTime?
  createdAt DateTime       @default(now())
  entries   ContestEntry[]
  votes     ContestVote[]
}

model ContestEntry {
  id          String        @id @default(cuid())
  contestId   String
  title       String
  imageUrl    String?
  votes       Int           @default(0)
  createdAt   DateTime      @default(now())
  publicId    String
  deletedAt   DateTime?
  contest     Contest       @relation(fields: [contestId], references: [id], onDelete: Cascade)
  voteRecords ContestVote[] @relation("EntryVotes")

  @@unique([contestId, title], name: "contestId_title")
  @@index([contestId, deletedAt])
  @@index([contestId, createdAt])
}

model ContestVote {
  id        String       @id @default(cuid())
  contestId String
  ipHash    String
  uaHash    String?
  createdAt DateTime     @default(now())
  entryId   String
  contest   Contest      @relation(fields: [contestId], references: [id], onDelete: Cascade)
  entry     ContestEntry @relation("EntryVotes", fields: [entryId], references: [id], onDelete: Cascade)

  @@unique([entryId, ipHash], name: "one_vote_per_entry_per_ip")
  @@index([contestId])
}

model Highlight {
  id        String    @id @default(cuid())
  slug      String    @unique
  title     String
  type      String
  publicId  String
  url       String
  posterUrl String?
  startSec  Int?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime?
  deletedBy String?
}

model GalleryToProduct {
  A               String
  B               String
  ProviderGallery Gallery @relation(fields: [A], references: [id], onDelete: Cascade)
  Product         Product @relation(fields: [B], references: [id], onDelete: Cascade)

  @@id([A, B], map: "_GalleryToProduct_AB_pkey")
  @@index([B], map: "_GalleryToProduct_B_index")
  @@map("_GalleryToProduct")
}

enum GalleryCategory {
  HAPPY
  MEMORIAM
}

